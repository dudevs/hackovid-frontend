(this.webpackJsonpsupermercats=this.webpackJsonpsupermercats||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a(41)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){e.exports=a.p+"static/media/baby_food.53d0c62b.png"},function(e,t,a){e.exports=a.p+"static/media/canned_food.fdcc8c91.png"},function(e,t,a){e.exports=a.p+"static/media/eggs.b8f4eeb8.png"},function(e,t,a){e.exports=a.p+"static/media/flour.6ece964f.png"},function(e,t,a){e.exports=a.p+"static/media/fruit.ffa30d5e.png"},function(e,t,a){e.exports=a.p+"static/media/hand_soap.e4f78d1c.png"},function(e,t,a){e.exports=a.p+"static/media/milk.f7bdb95d.png"},function(e,t,a){e.exports=a.p+"static/media/oil.d1d2ff36.png"},function(e,t,a){e.exports=a.p+"static/media/pasta.c2d0b752.png"},function(e,t,a){e.exports=a.p+"static/media/rice.1a0fe5f1.png"},function(e,t,a){e.exports=a.p+"static/media/toilet_paper.d4b5d890.png"},function(e,t,a){e.exports=a.p+"static/media/vegetables.25ec5087.png"},function(e,t,a){e.exports=a.p+"static/media/water.2409271a.png"},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(10),i=a.n(c),o=(a(21),a(2)),s=a.n(o),l=a(5),u=a(11),m=a(12),d=a(13),p=a(15),f=(a(23),function(e){var t=e.geoFindMe,a=e.findAddress,n=e.onInputChange;return r.a.createElement("form",{className:"search-form"},r.a.createElement("div",{className:"search-address"},r.a.createElement("input",{type:"text",placeholder:"Adre\xe7a",onChange:n,onSubmit:a}),r.a.createElement("button",{className:"address",onClick:a},"Buscar"),r.a.createElement("input",{type:"submit",onSubmit:a,hidden:!0})),r.a.createElement("button",{className:"locate",onClick:t},"Localitza'm"))}),v=function(e){var t=e.store,a=e.selectStore;return r.a.createElement("div",{className:"store",key:t.id,id:t.id,onClick:a},r.a.createElement("h1",null,t.name),r.a.createElement("h3",null,t.address," ",r.a.createElement("span",null,t.distance,"m")))},g=(a(24),function(e){var t,a=e.selectStore,n=e.nearStores,c=e.selectedStore,i=n.find((function(e){return e.id===c}));return t=c?r.a.createElement(v,{store:i,selectStore:a}):n.map((function(e){return r.a.createElement(v,{key:e.id,store:e,selectStore:a})})),r.a.createElement("div",{className:"stores"},t)}),h=a(7),E=a(14),b=a(25),S=a(26),w=a(27),N=a(28),k=a(29),x=a(30),O=a(31),T=a(32),y=a(33),_=a(34),I=a(35),j=a(36),C=a(37),P=function(e){var t,a=e.hour,c=e.min,i=e.votes;0===i&&(t="gray"),i>0&&(t="green"),i<0&&(t="red");var o="";return"00"!==c&&"30"!==c||(o=r.a.createElement(n.Fragment,null,r.a.createElement("p",null,a,":",c))),r.a.createElement("div",{className:"time-piece ".concat(t)},o)},A=a(43),M=a(44),B=a(45),D=a(46),F=function(){var e=Object(l.a)(s.a.mark((function e(t,a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:a});case 2:n=e.sent,e.t0=n.status,e.next=200===e.t0?6:400===e.t0?7:500===e.t0?8:9;break;case 6:return e.abrupt("return",n.json());case 7:throw new Error("400");case 8:throw new Error("500");case 9:throw new Error("not working");case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),L=function(e){switch(e.message){case"400":alert("Hi ha hagut un error, prova-ho m\xe9s tard");break;case"500":alert("El servei no est\xe0 disponible");break;default:console.log("Hi ha hagut un error: "+e),alert("Hi ha hagut un error, prova-ho m\xe9s tard")}},U={baby_food:b,canned_food:S,eggs:w,flour:N,fruit:k,hand_soap:x,milk:O,oil:T,pasta:y,rice:_,toilet_paper:I,vegetables:j,water:C},H=function(e){var t=e.baseProduct,a=e.dbProduct,n=e.state,c=e.getTimeline,i=e.BASE_ENDPOINT,o=n.options,u=o.TIMELINE_SPLIT_COUNT,m=o.MINUTES_PER_PIECE,d=function(){var e=Object(M.a)(Date.now());return Object(B.a)(e,e.getMinutes()%m)}(),p=[];Object(E.a)(Array(u)).forEach((function(){var e={};e.timestamp=Object(D.a)(d);var t=!1;if(a){var n=a.timeline.filter((function(t){return t.timestamp===e.timestamp}));t=Object(h.a)(n,1)[0]}t?(e.upvote=t.upvote,e.downvote=t.downvote):(e.upvote=0,e.downvote=0),d=Object(B.a)(d,m),p.unshift(e)}));var f=p.map((function(e){var t=function(e){var t=function(e){return e<10?"0"+e:e.toString()};return[t(Object(A.a)(e).getHours()),t(Object(A.a)(e).getMinutes())]}(e.timestamp),a=Object(h.a)(t,2),n=a[0],c=a[1],i=e.upvote-e.downvote;return r.a.createElement(P,{hour:n,min:c,votes:i,key:n+c})})),v=function(){var e=Object(l.a)(s.a.mark((function e(t){var a,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.currentTarget.dataset,r=a.product,o=a.vote,l="".concat(i,"/supermarket/").concat(n.selectedStore,"/basicgood/").concat(r,"?status=").concat(o),e.prev=2,e.next=5,F(l,"POST").catch(L);case 5:c().catch(L),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),L(e.t0);case 11:case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{id:t.item,className:"product"},r.a.createElement("img",{className:"product-image",src:U[t.item],alt:t.item}),r.a.createElement("div",{className:"product-timeline"},f),r.a.createElement("div",{className:"vote"},r.a.createElement("button",{className:"green","data-product":t.item,"data-vote":"true",onClick:v},"SI"),r.a.createElement("button",{className:"red","data-product":t.item,"data-vote":"false",onClick:v},"NO")))},R=(a(38),[{item:"water",timeline:[]},{item:"canned_food",timeline:[]},{item:"fruit",timeline:[]},{item:"vegetables",timeline:[]},{item:"pasta",timeline:[]},{item:"rice",timeline:[]},{item:"oil",timeline:[]},{item:"flour",timeline:[]},{item:"milk",timeline:[]},{item:"eggs",timeline:[]},{item:"baby_food",timeline:[]},{item:"hand_soap",timeline:[]},{item:"toilet_paper",timeline:[]}]),W=function(e){var t,a,c=e.state,i=e.getTimeline,o=e.BASE_ENDPOINT;return c.selectedStore&&(t=R.map((function(e){var t=c.storeTimeline.filter((function(t){return t.item===e.item})),a=Object(h.a)(t,1)[0];return r.a.createElement(H,{key:e.item,baseProduct:e,dbProduct:a,state:c,getTimeline:i,BASE_ENDPOINT:o})})),a=r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"comment"},r.a.createElement("p",null,"Vota si has vist recentment el producte disponible")))),r.a.createElement("div",{className:"product-list"},a,t)},z=(a(39),function(e){var t;return e.loading&&(t=r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"my-loader"},r.a.createElement("div",{className:"lds-roller"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null)))))),r.a.createElement("div",null,t)}),G=(a(40),"http://dispocat.sytes.net:4001/api"),J={loading:!1,input:"",currentLocation:{lat:"",lon:""},nearStores:[],selectedStore:"",storeTimeline:[],options:{TIMELINE_SPLIT_COUNT:48,MINUTES_PER_PIECE:5}},Q=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).geoFindMe=function(t){t.preventDefault(),e.setState(J);navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){var a=[t.coords.latitude,t.coords.longitude],n=a[0],r=a[1];e.setState({currentLocation:{lat:n,lon:r}});var c="".concat(G,"/supermarket/bylocation?lat=").concat(n,"&lon=").concat(r);e.searchStores(c).catch(L)}),(function(e){return console.log(e)})):alert("No tens activada la geolocalitzacio")},e.onInputChange=function(t){e.setState({input:t.target.value})},e.findAddress=function(t){if(t.preventDefault(),e.setState(J),e.state.input)if("rickroll"!==e.state.input){var a="".concat(G,"/supermarket/byaddress?address=").concat(encodeURI(e.state.input));e.searchStores(a).catch(L)}else window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ")},e.searchStores=function(){var t=Object(l.a)(s.a.mark((function t(a){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return document.querySelector(".search-form input").value="",t.prev=2,e.setState({loading:!0}),t.next=6,F(a,"GET");case 6:n=t.sent,e.setState({nearStores:n,loading:!1}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),e.setState({loading:!1}),L(t.t0);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e){return t.apply(this,arguments)}}(),e.selectStore=function(){var t=Object(l.a)(s.a.mark((function t(a){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({selectedStore:a.currentTarget.id});case 2:e.getTimeline().catch(L);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.getTimeline=Object(l.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a="".concat(G,"/supermarket/").concat(e.state.selectedStore),t.prev=1,e.setState({loading:!0}),t.next=5,F(a,"GET");case 5:n=t.sent,e.setState({storeTimeline:n,loading:!1}),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),e.setState({loading:!1}),L(t.t0);case 13:case 14:case"end":return t.stop()}}),t,null,[[1,9]])}))),e.state=J,e}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"limit-width"},r.a.createElement(f,{geoFindMe:this.geoFindMe,findAddress:this.findAddress,onInputChange:this.onInputChange}),r.a.createElement(z,{loading:this.state.loading}),r.a.createElement(g,{nearStores:this.state.nearStores,selectStore:this.selectStore,selectedStore:this.state.selectedStore}),r.a.createElement(W,{state:this.state,getTimeline:this.getTimeline,BASE_ENDPOINT:G})))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[16,1,2]]]);
//# sourceMappingURL=main.445e348f.chunk.js.map